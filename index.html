<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IB Recruiting CRM</title>
    <link rel="icon" href="https://github.com/simongt18/ib-recruiting-crm/blob/main/ChatGPT%20Image%20Feb%2012,%202026,%2012_46_53%20PM.png?raw=true">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:wght@400;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    },
                    colors: {
                        navy: {
                            DEFAULT: '#0f172a', // Slate 900
                            light: '#1e293b',   // Slate 800
                            lighter: '#334155', // Slate 700
                        },
                        gold: {
                            DEFAULT: '#C5A065',
                            light: '#E5CCA0',
                        }
                    },
                    boxShadow: {
                        'sm': '0 1px 2px 0 rgba(0, 0, 0, 0.05)',
                        'DEFAULT': '0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)',
                    }
                }
            }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-[#F3F5F8] text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const supabaseUrl = 'https://iajwmuuhpvvimtzcnjtm.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlhandtdXVocHZ2aW10emNuanRtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4NTQ2MDcsImV4cCI6MjA4NjQzMDYwN30.KSSVVpOJBpXL0chYETYh0fvmD9wdlOeVZRuZe3ZhC-8';
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);

        const APPLICATION_STATUSES = [
            'Not Applied',
            'Applied',
            'HireVue/Assessment Pending',
            'HireVue/Assessment Completed',
            'Interview Scheduled',
            'Interview Completed',
            'Offered',
            'Accepted',
            'Rejected'
        ];

        const CONTACT_STATUSES = [
            'To Reach Out',
            'Reached Out',
            'Responded',
            'Meeting Scheduled',
            'Met'
        ];

        const INTERACTION_TYPES = [
            'Email Sent',
            'Email Received',
            'Phone Call',
            'Coffee Chat',
            'Informational Interview',
            'Formal Interview',
            'Networking Event',
            'LinkedIn Message',
            'Text Message',
            'Other'
        ];

        const REMINDER_TYPES = [
            'Follow-up',
            'Assessment',
            'HireVue',
            'Interview',
            'Application Deadline',
            'Other'
        ];

        // Location data - major financial centers
        const CITIES = {
            'United States': ['New York', 'San Francisco', 'Chicago', 'Boston', 'Los Angeles', 'Houston', 'Charlotte', 'Dallas', 'Miami', 'Atlanta'],
            'United Kingdom': ['London', 'Edinburgh'],
            'China': ['Hong Kong', 'Shanghai', 'Beijing', 'Shenzhen'],
            'Japan': ['Tokyo', 'Osaka'],
            'Singapore': ['Singapore'],
            'Switzerland': ['Zurich', 'Geneva'],
            'Germany': ['Frankfurt', 'Munich', 'Berlin'],
            'France': ['Paris'],
            'Canada': ['Toronto', 'Montreal', 'Vancouver'],
            'Australia': ['Sydney', 'Melbourne'],
            'UAE': ['Dubai', 'Abu Dhabi'],
            'India': ['Mumbai', 'Bangalore', 'Delhi'],
            'Other': ['Other']
        };

        const US_STATES = {
            'New York': 'NY',
            'San Francisco': 'CA',
            'Los Angeles': 'CA',
            'Chicago': 'IL',
            'Boston': 'MA',
            'Houston': 'TX',
            'Charlotte': 'NC',
            'Dallas': 'TX',
            'Miami': 'FL',
            'Atlanta': 'GA'
        };

        function formatLocation(city, country) {
            if (country === 'United States' && US_STATES[city]) {
                return `${city}, ${US_STATES[city]}, USA`;
            }
            if (country === 'Singapore' || country === 'Other') {
                return city;
            }
            return `${city}, ${country}`;
        }

        function Auth() {
            const [loading, setLoading] = useState(false);
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [isSignUp, setIsSignUp] = useState(false);

            const handleAuth = async (e) => {
                e.preventDefault();
                setLoading(true);
                try {
                    if (isSignUp) {
                        const { error } = await supabase.auth.signUp({ email, password });
                        if (error) throw error;
                        alert('Check your email for the login link!');
                    } else {
                        const { error } = await supabase.auth.signInWithPassword({ email, password });
                        if (error) throw error;
                    }
                } catch (error) {
                    alert(error.message);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="min-h-screen flex items-center justify-center bg-[#F3F5F8] py-12 px-4 sm:px-6 lg:px-8">
                    <div className="max-w-md w-full space-y-8 bg-white p-8 rounded border border-slate-200 shadow-sm">
                        <h2 className="text-center text-3xl font-bold font-serif text-navy">{isSignUp ? 'Create Account' : 'Sign In'}</h2>
                        <form className="mt-8 space-y-6" onSubmit={handleAuth}>
                            <input type="email" required className="appearance-none rounded-none relative block w-full px-3 py-2 border border-slate-300 placeholder-slate-500 text-slate-900 rounded-t focus:outline-none focus:ring-navy focus:border-navy focus:z-10 sm:text-sm" placeholder="Email address" value={email} onChange={(e) => setEmail(e.target.value)} />
                            <input type="password" required className="appearance-none rounded-none relative block w-full px-3 py-2 border border-slate-300 placeholder-slate-500 text-slate-900 rounded-b focus:outline-none focus:ring-navy focus:border-navy focus:z-10 sm:text-sm" placeholder="Password" value={password} onChange={(e) => setPassword(e.target.value)} />
                            <button type="submit" disabled={loading} className="group relative w-full flex justify-center py-2 px-4 border border-transparent text-xs font-bold uppercase tracking-wider rounded text-white bg-navy hover:bg-navy-light focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-navy">{loading ? 'LOADING...' : (isSignUp ? 'SIGN UP' : 'SIGN IN')}</button>
                        </form>
                        <div className="text-center"><button className="text-navy hover:text-navy-light text-xs uppercase tracking-wide font-medium" onClick={() => setIsSignUp(!isSignUp)}>{isSignUp ? 'Already have an account? Sign in' : "Don't have an account? Sign up"}</button></div>
                    </div>
                </div>
            );
        }

        function App() {
            const [session, setSession] = useState(null);
            const [activeTab, setActiveTab] = useState('firms');
            const [firms, setFirms] = useState([]);
            const [contacts, setContacts] = useState([]);
            const [interactions, setInteractions] = useState([]);
            const [reminders, setReminders] = useState([]);
            const [showAddFirm, setShowAddFirm] = useState(false);
            const [showAddContact, setShowAddContact] = useState(false);
            const [showAddReminder, setShowAddReminder] = useState(false);
            const [selectedFirm, setSelectedFirm] = useState(null);
            const [selectedContact, setSelectedContact] = useState(null);
            const [editingContact, setEditingContact] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                supabase.auth.getSession().then(({ data: { session } }) => {
                    setSession(session);
                    if (session) fetchData();
                    else setLoading(false);
                });

                const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, session) => {
                    setSession(session);
                    if (session) fetchData();
                    else setLoading(false);
                });

                return () => subscription.unsubscribe();
            }, []);

            const fetchData = async () => {
                setLoading(true);
                try {
                    const { data: firmsData } = await supabase.from('firms').select('*');
                    const { data: contactsData } = await supabase.from('contacts').select('*');
                    const { data: interactionsData } = await supabase.from('interactions').select('*');
                    const { data: remindersData } = await supabase.from('reminders').select('*');

                    if (firmsData) setFirms(firmsData);
                    if (contactsData) setContacts(contactsData);
                    if (interactionsData) setInteractions(interactionsData);
                    if (remindersData) setReminders(remindersData);
                } catch (error) {
                    console.error('Error fetching data:', error);
                } finally {
                    setLoading(false);
                }
            };

            const addFirm = async (firm) => {
                try {
                    const { data, error } = await supabase.from('firms').insert([{ ...firm, user_id: session.user.id }]).select();
                    if (error) throw error;
                    setFirms([...firms, data[0]]);
                    setShowAddFirm(false);
                } catch (error) {
                    alert('Error adding firm: ' + error.message);
                }
            };

            const updateFirm = async (id, updates) => {
                try {
                    const { error } = await supabase.from('firms').update(updates).eq('id', id);
                    if (error) throw error;
                    setFirms(firms.map(f => f.id === id ? { ...f, ...updates } : f));
                } catch (error) {
                    alert('Error updating firm: ' + error.message);
                }
            };

            const deleteFirm = async (id) => {
                if (confirm('Delete this firm and all associated contacts?')) {
                    try {
                        const { error } = await supabase.from('firms').delete().eq('id', id);
                        if (error) throw error;
                        setFirms(firms.filter(f => f.id !== id));
                        setContacts(contacts.filter(c => c.firm_id !== id));
                        if (selectedFirm && selectedFirm.id === id) {
                            setSelectedFirm(null);
                        }
                    } catch (error) {
                        alert('Error deleting firm: ' + error.message);
                    }
                }
            };

            const addContact = async (contact) => {
                try {
                    if (editingContact) {
                        const { error } = await supabase.from('contacts').update(contact).eq('id', editingContact.id);
                        if (error) throw error;
                        setContacts(contacts.map(c => c.id === editingContact.id ? { ...c, ...contact } : c));
                        setEditingContact(null);
                    } else {
                        const { data, error } = await supabase.from('contacts').insert([{ ...contact, user_id: session.user.id }]).select();
                        if (error) throw error;
                        setContacts([...contacts, data[0]]);
                    }
                    setShowAddContact(false);
                } catch (error) {
                    alert('Error saving contact: ' + error.message);
                }
            };

            const deleteContact = async (id) => {
                if (confirm('Delete this contact and all associated interactions?')) {
                    try {
                        const { error } = await supabase.from('contacts').delete().eq('id', id);
                        if (error) throw error;
                        setContacts(contacts.filter(c => c.id !== id));
                        setInteractions(interactions.filter(i => i.contact_id !== id));
                    } catch (error) {
                        alert('Error deleting contact: ' + error.message);
                    }
                }
            };

            const addInteraction = async (interaction) => {
                try {
                    const { data, error } = await supabase.from('interactions').insert([{ ...interaction, user_id: session.user.id }]).select();
                    if (error) throw error;
                    setInteractions([...interactions, data[0]]);
                } catch (error) {
                    alert('Error adding interaction: ' + error.message);
                }
            };

            const deleteInteraction = async (id) => {
                if (confirm('Delete this interaction?')) {
                    try {
                        const { error } = await supabase.from('interactions').delete().eq('id', id);
                        if (error) throw error;
                        setInteractions(interactions.filter(i => i.id !== id));
                    } catch (error) {
                        alert('Error deleting interaction: ' + error.message);
                    }
                }
            };

            const addReminder = async (reminder) => {
                try {
                    const { data, error } = await supabase.from('reminders').insert([{ ...reminder, completed: false, user_id: session.user.id }]).select();
                    if (error) throw error;
                    setReminders([...reminders, data[0]]);
                    setShowAddReminder(false);
                } catch (error) {
                    alert('Error adding reminder: ' + error.message);
                }
            };

            const toggleReminder = async (id) => {
                try {
                    const reminder = reminders.find(r => r.id === id);
                    const { error } = await supabase.from('reminders').update({ completed: !reminder.completed }).eq('id', id);
                    if (error) throw error;
                    setReminders(reminders.map(r => r.id === id ? { ...r, completed: !r.completed } : r));
                } catch (error) {
                    alert('Error updating reminder: ' + error.message);
                }
            };

            const deleteReminder = async (id) => {
                try {
                    const { error } = await supabase.from('reminders').delete().eq('id', id);
                    if (error) throw error;
                    setReminders(reminders.filter(r => r.id !== id));
                } catch (error) {
                    alert('Error deleting reminder: ' + error.message);
                }
            };

            if (loading) {
                return (
                    <div className="flex items-center justify-center h-screen">
                        <div className="text-xl text-gray-600">Loading...</div>
                    </div>
                );
            }

            if (!session) {
                return <Auth />;
            }

            return (
                <div className="min-h-screen pb-20 md:pb-0">
                    {/* Header */}
                    <header className="bg-navy text-white shadow-sm sticky top-0 z-50 border-b border-navy-light">
                        <div className="container mx-auto px-4 py-4">
                            <div className="flex justify-between items-center">
                                <div>
                                    <h1 className="text-2xl md:text-3xl font-bold font-serif tracking-tight">IB Recruiting CRM</h1>
                                    <p className="text-slate-400 text-xs mt-1 font-medium uppercase tracking-widest">Advisory & Capital Markets Tracker</p>
                                </div>
                                <div className="flex gap-2">
                                    <button
                                        onClick={() => supabase.auth.signOut()}
                                        className="bg-navy-light hover:bg-navy-lighter px-4 py-2 rounded text-xs font-semibold uppercase tracking-wider flex items-center gap-2 transition-colors border border-slate-700"
                                    >
                                        <i className="fas fa-sign-out-alt"></i>
                                        <span className="hidden md:inline">Sign Out</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* Navigation */}
                    <nav className="bg-white border-b border-slate-200 sticky top-16 z-40">
                        <div className="container mx-auto px-4">
                            <div className="flex space-x-1 overflow-x-auto">
                                {['firms', 'contacts', 'calendar', 'analytics'].map(tab => (
                                    <button
                                        key={tab}
                                        onClick={() => setActiveTab(tab)}
                                        className={`px-6 py-4 text-xs font-bold uppercase tracking-widest whitespace-nowrap transition-colors border-b-2 ${
                                            activeTab === tab
                                                ? 'border-navy text-navy'
                                                : 'border-transparent text-slate-500 hover:text-navy hover:border-slate-300'
                                        }`}
                                    >
                                        <i className={`fas fa-${tab === 'firms' ? 'building' : tab === 'contacts' ? 'users' : tab === 'calendar' ? 'calendar' : 'chart-line'} mr-2`}></i>
                                        {tab}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </nav>

                    {/* Main Content */}
                    <main className="container mx-auto px-4 py-6">
                        {activeTab === 'firms' && (
                            <FirmsView
                                firms={firms}
                                contacts={contacts}
                                interactions={interactions}
                                onAddFirm={() => setShowAddFirm(true)}
                                onUpdateFirm={updateFirm}
                                onDeleteFirm={deleteFirm}
                                onSelectFirm={setSelectedFirm}
                            />
                        )}
                        {activeTab === 'contacts' && (
                            <ContactsView
                                contacts={contacts}
                                firms={firms}
                                interactions={interactions}
                                onAddContact={() => setShowAddContact(true)}
                                onEditContact={(contact) => {
                                    setEditingContact(contact);
                                    setShowAddContact(true);
                                }}
                                onDeleteContact={deleteContact}
                                onSelectContact={setSelectedContact}
                                onAddReminder={(contact) => {
                                    setShowAddReminder(contact);
                                }}
                            />
                        )}
                        {activeTab === 'calendar' && (
                            <CalendarView
                                reminders={reminders}
                                contacts={contacts}
                                firms={firms}
                                onAddReminder={() => setShowAddReminder(true)}
                                onToggleReminder={toggleReminder}
                                onDeleteReminder={deleteReminder}
                            />
                        )}
                        {activeTab === 'analytics' && (
                            <AnalyticsView
                                firms={firms}
                                contacts={contacts}
                                interactions={interactions}
                                reminders={reminders}
                            />
                        )}
                    </main>

                    {/* Modals */}
                    {showAddFirm && (
                        <AddFirmModal 
                            firms={firms}
                            onClose={() => setShowAddFirm(false)} 
                            onAdd={addFirm} 
                        />
                    )}
                    {showAddContact && (
                        <AddContactModal
                            firms={firms}
                            contact={editingContact}
                            onClose={() => {
                                setShowAddContact(false);
                                setEditingContact(null);
                            }}
                            onAdd={addContact}
                        />
                    )}
                    {showAddReminder && (
                        <AddReminderModal
                            contacts={contacts}
                            firms={firms}
                            preselectedContact={typeof showAddReminder === 'object' ? showAddReminder : null}
                            onClose={() => setShowAddReminder(false)}
                            onAdd={addReminder}
                        />
                    )}
                    {selectedFirm && (
                        <FirmDetailModal
                            firm={selectedFirm}
                            contacts={contacts.filter(c => c.firm_id === selectedFirm.id)}
                            interactions={interactions}
                            onClose={() => setSelectedFirm(null)}
                            onUpdateFirm={updateFirm}
                            onDeleteFirm={deleteFirm}
                        />
                    )}
                    {selectedContact && (
                        <ContactDetailModal
                            contact={selectedContact}
                            firm={firms.find(f => f.id === selectedContact.firm_id)}
                            interactions={interactions.filter(i => i.contact_id === selectedContact.id)}
                            onClose={() => setSelectedContact(null)}
                            onAddInteraction={addInteraction}
                            onDeleteInteraction={deleteInteraction}
                            onAddReminder={() => setShowAddReminder(selectedContact)}
                        />
                    )}
                </div>
            );
        }

        function FirmsView({ firms, contacts, interactions, onAddFirm, onUpdateFirm, onDeleteFirm, onSelectFirm }) {
            const [sortBy, setSortBy] = useState('ranking');
            const [filterLocation, setFilterLocation] = useState('all');
            const [filterStatus, setFilterStatus] = useState('all');
            const [viewMode, setViewMode] = useState('grid');

            // Get unique locations
            const locations = [...new Set(firms.map(f => f.office).filter(Boolean))].sort();

            // Get last contact date for each firm
            const getLastContactDate = (firmId) => {
                const firmContacts = contacts.filter(c => c.firm_id === firmId);
                const firmInteractions = interactions.filter(i => 
                    firmContacts.some(c => c.id === i.contact_id)
                );
                if (firmInteractions.length === 0) return null;
                const dates = firmInteractions
                    .map(i => new Date(i.date))
                    .filter(d => !isNaN(d.getTime()));
                if (dates.length === 0) return null;
                return new Date(Math.max(...dates));
            };

            const filteredFirms = firms.filter(firm => {
                if (filterLocation !== 'all' && firm.office !== filterLocation) return false;
                if (filterStatus !== 'all' && firm.status !== filterStatus) return false;
                return true;
            });

            const sortedFirms = [...filteredFirms].sort((a, b) => {
                if (sortBy === 'ranking') {
                    // Ranked firms (1-10) come first, then unranked
                    const aRank = a.ranking || 999;
                    const bRank = b.ranking || 999;
                    if (aRank !== bRank) return aRank - bRank;
                    return a.name.localeCompare(b.name);
                }
                if (sortBy === 'name') return a.name.localeCompare(b.name);
                if (sortBy === 'lastContact') {
                    const aDate = getLastContactDate(a.id);
                    const bDate = getLastContactDate(b.id);
                    if (!aDate && !bDate) return 0;
                    if (!aDate) return 1;
                    if (!bDate) return -1;
                    return bDate - aDate; // Most recent first
                }
                return 0;
            });

            return (
                <div>
                    <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                        <h2 className="text-2xl font-bold text-navy font-serif">TARGET FIRMS</h2>
                        <div className="flex gap-3">
                            <div className="flex bg-slate-100 rounded p-1 border border-slate-200">
                                <button onClick={() => setViewMode('grid')} className={`px-3 py-1.5 rounded text-xs transition-all ${viewMode === 'grid' ? 'bg-white shadow-sm text-navy' : 'text-slate-400 hover:text-navy'}`}>
                                    <i className="fas fa-th-large"></i>
                                </button>
                                <button onClick={() => setViewMode('list')} className={`px-3 py-1.5 rounded text-xs transition-all ${viewMode === 'list' ? 'bg-white shadow-sm text-navy' : 'text-slate-400 hover:text-navy'}`}>
                                    <i className="fas fa-list"></i>
                                </button>
                            </div>
                            <button
                                onClick={onAddFirm}
                                className="bg-navy text-white px-4 py-2 rounded text-xs font-bold uppercase tracking-wider hover:bg-navy-light transition-colors shadow-sm"
                            >
                                <i className="fas fa-plus mr-2"></i>Add Firm
                            </button>
                        </div>
                    </div>

                    {/* Filters */}
                    <div className="bg-white rounded border border-slate-200 p-4 mb-6 shadow-sm">
                        <div className="grid grid-cols-1 md:grid-cols-4 gap-3">
                            <div>
                                <label className="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">Sort By</label>
                                <select
                                    value={sortBy}
                                    onChange={(e) => setSortBy(e.target.value)}
                                    className="w-full border border-slate-300 rounded px-3 py-2 text-sm focus:ring-navy focus:border-navy"
                                >
                                    <option value="ranking">Ranking</option>
                                    <option value="name">Name</option>
                                    <option value="lastContact">Last Contact</option>
                                </select>
                            </div>
                            <div>
                                <label className="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">Location</label>
                                <select
                                    value={filterLocation}
                                    onChange={(e) => setFilterLocation(e.target.value)}
                                    className="w-full border border-slate-300 rounded px-3 py-2 text-sm focus:ring-navy focus:border-navy"
                                >
                                    <option value="all">All Locations</option>
                                    {locations.map(loc => (
                                        <option key={loc} value={loc}>{loc}</option>
                                    ))}
                                </select>
                            </div>
                            <div>
                                <label className="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">Status</label>
                                <select
                                    value={filterStatus}
                                    onChange={(e) => setFilterStatus(e.target.value)}
                                    className="w-full border border-slate-300 rounded px-3 py-2 text-sm focus:ring-navy focus:border-navy"
                                >
                                    <option value="all">All Statuses</option>
                                    {APPLICATION_STATUSES.map(status => (
                                        <option key={status} value={status}>{status}</option>
                                    ))}
                                </select>
                            </div>
                            <div className="flex items-end">
                                <button
                                    onClick={() => {
                                        setSortBy('ranking');
                                        setFilterLocation('all');
                                        setFilterStatus('all');
                                    }}
                                    className="w-full border border-slate-300 rounded px-3 py-2 text-xs font-bold uppercase tracking-wider hover:bg-slate-50 text-slate-600"
                                >
                                    Clear Filters
                                </button>
                            </div>
                        </div>
                    </div>

                    {filteredFirms.length === 0 ? (
                        <div className="text-center py-12 bg-white rounded border border-slate-200 shadow-sm">
                            <i className="fas fa-building text-6xl text-slate-200 mb-4"></i>
                            <p className="text-slate-500 text-lg font-serif">No firms found</p>
                            <button
                                onClick={onAddFirm}
                                className="mt-4 text-navy hover:text-navy-light font-bold uppercase tracking-wide text-sm"
                            >
                                Add your first firm
                            </button>
                        </div>
                    ) : viewMode === 'grid' ? (
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            {sortedFirms.map(firm => {
                                const firmContacts = contacts.filter(c => c.firm_id === firm.id);
                                const lastContact = getLastContactDate(firm.id);
                                return (
                                    <div
                                        key={firm.id}
                                        className="bg-white rounded border border-slate-200 hover:border-navy hover:shadow-md transition-all p-5 cursor-pointer group"
                                        onClick={() => onSelectFirm(firm)}
                                    >
                                        <div className="flex justify-between items-start mb-3">
                                            <div className="flex-1">
                                                <div className="flex items-center gap-2 mb-1">
                                                    {firm.ranking && firm.ranking <= 10 ? (
                                                        <span className="bg-navy text-white font-bold text-xs w-6 h-6 rounded-full flex items-center justify-center border border-navy">
                                                            {firm.ranking}
                                                        </span>
                                                    ) : (
                                                        <span className="bg-slate-100 text-slate-500 text-[10px] uppercase tracking-wider px-2 py-0.5 rounded border border-slate-200">
                                                            Unranked
                                                        </span>
                                                    )}
                                                    <h3 className="font-bold text-lg text-navy font-serif group-hover:text-navy-light">{firm.name}</h3>
                                                </div>
                                                {firm.office && (
                                                    <p className="text-xs text-slate-500 uppercase tracking-wide font-medium">
                                                        <i className="fas fa-map-marker-alt mr-1"></i>
                                                        {firm.office}
                                                    </p>
                                                )}
                                            </div>
                                            <span className={`px-2 py-1 rounded text-[10px] uppercase tracking-wider font-bold whitespace-nowrap border ${
                                                firm.status === 'Accepted' ? 'bg-emerald-50 text-emerald-700 border-emerald-200' :
                                                firm.status === 'Offered' ? 'bg-emerald-50 text-emerald-700 border-emerald-200' :
                                                firm.status === 'Interview Completed' ? 'bg-blue-50 text-blue-700 border-blue-200' :
                                                firm.status === 'Interview Scheduled' ? 'bg-indigo-50 text-indigo-700 border-indigo-200' :
                                                firm.status === 'HireVue/Assessment Completed' ? 'bg-violet-50 text-violet-700 border-violet-200' :
                                                firm.status === 'HireVue/Assessment Pending' ? 'bg-amber-50 text-amber-700 border-amber-200' :
                                                firm.status === 'Applied' ? 'bg-sky-50 text-sky-700 border-sky-200' :
                                                firm.status === 'Rejected' ? 'bg-red-50 text-red-700 border-red-200' :
                                                'bg-slate-50 text-slate-600 border-slate-200'
                                            }`}>
                                                {firm.status}
                                            </span>
                                        </div>
                                        <p className="text-slate-600 text-sm mb-4 border-t border-slate-100 pt-3">{firm.division || 'Generalist'}</p>
                                        <div className="flex items-center justify-between text-xs text-slate-500 font-medium">
                                            <div>
                                                <i className="fas fa-users mr-2"></i>
                                                {firmContacts.length} contact{firmContacts.length !== 1 ? 's' : ''}
                                            </div>
                                            {lastContact && !isNaN(lastContact.getTime()) && (
                                                <div>
                                                    Last: {lastContact.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    ) : (
                        <div className="bg-white rounded border border-slate-200 shadow-sm overflow-hidden">
                            <div className="overflow-x-auto">
                                <table className="w-full">
                                    <thead className="bg-slate-50 border-b border-slate-200">
                                        <tr>
                                            <th className="px-6 py-3 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">Rank</th>
                                            <th className="px-6 py-3 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">Firm</th>
                                            <th className="px-6 py-3 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">Division</th>
                                            <th className="px-6 py-3 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">Status</th>
                                            <th className="px-6 py-3 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">Contacts</th>
                                            <th className="px-6 py-3 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">Last Contact</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-slate-100">
                                        {sortedFirms.map(firm => {
                                            const firmContacts = contacts.filter(c => c.firm_id === firm.id);
                                            const lastContact = getLastContactDate(firm.id);
                                            return (
                                                <tr key={firm.id} className="hover:bg-slate-50 cursor-pointer transition-colors" onClick={() => onSelectFirm(firm)}>
                                                    <td className="px-6 py-4 whitespace-nowrap">
                                                        {firm.ranking && firm.ranking <= 10 ? (
                                                            <span className="bg-navy text-white font-bold text-xs w-6 h-6 rounded-full flex items-center justify-center border border-navy">
                                                                {firm.ranking}
                                                            </span>
                                                        ) : (
                                                            <span className="text-slate-400 text-xs">-</span>
                                                        )}
                                                    </td>
                                                    <td className="px-6 py-4 whitespace-nowrap">
                                                        <div className="font-bold text-navy">{firm.name}</div>
                                                        <div className="text-xs text-slate-500 uppercase tracking-wide">{firm.office}</div>
                                                    </td>
                                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-slate-600">
                                                        {firm.division || '-'}
                                                    </td>
                                                    <td className="px-6 py-4 whitespace-nowrap">
                                                        <span className={`px-2 py-1 rounded text-[10px] uppercase tracking-wider font-bold border ${
                                                            firm.status === 'Accepted' ? 'bg-emerald-50 text-emerald-700 border-emerald-200' :
                                                            firm.status === 'Offered' ? 'bg-emerald-50 text-emerald-700 border-emerald-200' :
                                                            firm.status === 'Interview Completed' ? 'bg-blue-50 text-blue-700 border-blue-200' :
                                                            firm.status === 'Interview Scheduled' ? 'bg-indigo-50 text-indigo-700 border-indigo-200' :
                                                            firm.status === 'HireVue/Assessment Completed' ? 'bg-violet-50 text-violet-700 border-violet-200' :
                                                            firm.status === 'HireVue/Assessment Pending' ? 'bg-amber-50 text-amber-700 border-amber-200' :
                                                            firm.status === 'Applied' ? 'bg-sky-50 text-sky-700 border-sky-200' :
                                                            firm.status === 'Rejected' ? 'bg-red-50 text-red-700 border-red-200' :
                                                            'bg-slate-50 text-slate-600 border-slate-200'
                                                        }`}>
                                                            {firm.status}
                                                        </span>
                                                    </td>
                                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-slate-600">
                                                        {firmContacts.length}
                                                    </td>
                                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-slate-600">
                                                        {lastContact && !isNaN(lastContact.getTime()) ? lastContact.toLocaleDateString() : '-'}
                                                    </td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        function ContactsView({ contacts, firms, interactions, onAddContact, onEditContact, onDeleteContact, onSelectContact, onAddReminder }) {
            const [filterFirm, setFilterFirm] = useState('all');
            const [filterStatus, setFilterStatus] = useState('all');

            const filteredContacts = contacts.filter(contact => {
                if (filterFirm !== 'all' && contact.firm_id !== parseInt(filterFirm)) return false;
                if (filterStatus !== 'all' && contact.status !== filterStatus) return false;
                return true;
            });

            return (
                <div>
                    <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                        <h2 className="text-2xl font-bold text-navy font-serif">CONTACTS</h2>
                        <div className="flex flex-col sm:flex-row gap-3 w-full md:w-auto">
                            <select
                                value={filterFirm}
                                onChange={(e) => setFilterFirm(e.target.value)}
                                className="border border-slate-300 rounded px-3 py-2 text-sm focus:ring-navy focus:border-navy"
                            >
                                <option value="all">All Firms</option>
                                {firms.map(firm => (
                                    <option key={firm.id} value={firm.id}>{firm.name} - {firm.office}</option>
                                ))}
                            </select>
                            <select
                                value={filterStatus}
                                onChange={(e) => setFilterStatus(e.target.value)}
                                className="border border-slate-300 rounded px-3 py-2 text-sm focus:ring-navy focus:border-navy"
                            >
                                <option value="all">All Statuses</option>
                                {CONTACT_STATUSES.map(status => (
                                    <option key={status} value={status}>{status}</option>
                                ))}
                            </select>
                            <button
                                onClick={onAddContact}
                                className="bg-navy text-white px-4 py-2 rounded text-xs font-bold uppercase tracking-wider hover:bg-navy-light transition-colors whitespace-nowrap shadow-sm"
                            >
                                <i className="fas fa-plus mr-2"></i>Add Contact
                            </button>
                        </div>
                    </div>

                    {filteredContacts.length === 0 ? (
                        <div className="text-center py-12 bg-white rounded border border-slate-200 shadow-sm">
                            <i className="fas fa-users text-6xl text-slate-200 mb-4"></i>
                            <p className="text-slate-500 text-lg font-serif">No contacts found</p>
                            <button
                                onClick={onAddContact}
                                className="mt-4 text-navy hover:text-navy-light font-bold uppercase tracking-wide text-sm"
                            >
                                Add your first contact
                            </button>
                        </div>
                    ) : (
                        <div className="bg-white rounded border border-slate-200 shadow-sm overflow-hidden">
                            <div className="overflow-x-auto">
                                <table className="w-full">
                                    <thead className="bg-slate-50 border-b border-slate-200">
                                        <tr>
                                            <th className="px-6 py-3 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">Name</th>
                                            <th className="px-6 py-3 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">Firm</th>
                                            <th className="px-6 py-3 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">Connection</th>
                                            <th className="px-6 py-3 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">Interactions</th>
                                            <th className="px-6 py-3 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">Status</th>
                                            <th className="px-6 py-3 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-slate-100">
                                        {filteredContacts.map(contact => {
                                            const firm = firms.find(f => f.id === contact.firm_id);
                                            const contactInteractions = interactions.filter(i => i.contact_id === contact.id);
                                            return (
                                                <tr key={contact.id} className="hover:bg-slate-50 cursor-pointer transition-colors" onClick={() => onSelectContact(contact)}>
                                                    <td className="px-6 py-4 whitespace-nowrap">
                                                        <div className="font-bold text-navy">{contact.name}</div>
                                                        {contact.title && (
                                                            <div className="text-xs text-slate-500">{contact.title}</div>
                                                        )}
                                                    </td>
                                                    <td className="px-6 py-4 whitespace-nowrap text-sm">
                                                        <div className="text-slate-900 font-medium">{firm?.name || 'Unknown'}</div>
                                                        {firm?.office && (
                                                            <div className="text-slate-500 text-xs">{firm.office}</div>
                                                        )}
                                                    </td>
                                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-slate-500">
                                                        {contact.connection_type || '-'}
                                                    </td>
                                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-slate-500">
                                                        {contactInteractions.length}
                                                    </td>
                                                    <td className="px-6 py-4 whitespace-nowrap">
                                                        <span className={`px-2 py-1 rounded text-[10px] uppercase tracking-wider font-bold border ${
                                                            contact.status === 'Met' ? 'bg-emerald-50 text-emerald-700 border-emerald-200' :
                                                            contact.status === 'Meeting Scheduled' ? 'bg-navy text-white border-navy' :
                                                            contact.status === 'Responded' ? 'bg-amber-50 text-amber-700 border-amber-200' :
                                                            contact.status === 'Reached Out' ? 'bg-violet-50 text-violet-700 border-violet-200' :
                                                            'bg-slate-50 text-slate-600 border-slate-200'
                                                        }`}>
                                                            {contact.status}
                                                        </span>
                                                    </td>
                                                    <td className="px-6 py-4 whitespace-nowrap text-sm">
                                                        <button
                                                            onClick={(e) => {
                                                                e.stopPropagation();
                                                                onAddReminder(contact);
                                                            }}
                                                            className="text-navy hover:text-navy-light mr-3"
                                                            title="Add Reminder"
                                                        >
                                                            <i className="fas fa-bell"></i>
                                                        </button>
                                                        <button
                                                            onClick={(e) => {
                                                                e.stopPropagation();
                                                                onEditContact(contact);
                                                            }}
                                                            className="text-slate-400 hover:text-navy mr-3"
                                                            title="Edit"
                                                        >
                                                            <i className="fas fa-edit"></i>
                                                        </button>
                                                        <button
                                                            onClick={(e) => {
                                                                e.stopPropagation();
                                                                onDeleteContact(contact.id);
                                                            }}
                                                            className="text-slate-400 hover:text-red-600"
                                                            title="Delete"
                                                        >
                                                            <i className="fas fa-trash"></i>
                                                        </button>
                                                    </td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        function CalendarView({ reminders, contacts, firms, onAddReminder, onToggleReminder, onDeleteReminder }) {
            const [view, setView] = useState('upcoming');

            const sortedReminders = [...reminders].sort((a, b) => new Date(a.date) - new Date(b.date));
            const today = new Date().toISOString().split('T')[0];

            const upcomingReminders = sortedReminders.filter(r => !r.completed && r.date >= today);
            const pastReminders = sortedReminders.filter(r => r.completed || r.date < today);

            const displayReminders = view === 'upcoming' ? upcomingReminders : pastReminders;

            return (
                <div>
                    <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                        <h2 className="text-2xl font-bold text-navy font-serif">FOLLOW-UP CALENDAR</h2>
                        <div className="flex gap-3">
                            <div className="flex bg-slate-100 rounded p-1 border border-slate-200">
                                <button
                                    onClick={() => setView('upcoming')}
                                    className={`px-4 py-2 rounded text-xs font-bold uppercase tracking-wider transition-all ${
                                        view === 'upcoming' ? 'bg-white shadow-sm text-navy' : 'text-slate-500 hover:text-navy'
                                    }`}
                                >
                                    Upcoming
                                </button>
                                <button
                                    onClick={() => setView('past')}
                                    className={`px-4 py-2 rounded text-xs font-bold uppercase tracking-wider transition-all ${
                                        view === 'past' ? 'bg-white shadow-sm text-navy' : 'text-slate-500 hover:text-navy'
                                    }`}
                                >
                                    Past
                                </button>
                            </div>
                            <button
                                onClick={onAddReminder}
                                className="bg-navy text-white px-4 py-2 rounded text-xs font-bold uppercase tracking-wider hover:bg-navy-light transition-colors shadow-sm"
                            >
                                <i className="fas fa-plus mr-2"></i>Add Reminder
                            </button>
                        </div>
                    </div>

                    {displayReminders.length === 0 ? (
                        <div className="text-center py-12 bg-white rounded border border-slate-200 shadow-sm">
                            <i className="fas fa-calendar-alt text-6xl text-slate-200 mb-4"></i>
                            <p className="text-slate-500 text-lg font-serif">
                                No {view === 'upcoming' ? 'upcoming' : 'past'} reminders
                            </p>
                        </div>
                    ) : (
                        <div className="space-y-3">
                            {displayReminders.map(reminder => {
                                const contact = contacts.find(c => c.id === reminder.contact_id);
                                const linkedFirm = reminder.firm_id ? firms.find(f => f.id === reminder.firm_id) : null;
                                const firm = contact ? firms.find(f => f.id === contact.firm_id) : linkedFirm;
                                const isPast = reminder.date < today;
                                const isToday = reminder.date === today;

                                return (
                                    <div
                                        key={reminder.id}
                                        className={`bg-white rounded border border-slate-200 p-4 shadow-sm transition-all hover:border-navy ${
                                            reminder.completed ? 'opacity-60 bg-slate-50' : ''
                                        } ${isToday && !reminder.completed ? 'border-l-4 border-l-navy' : ''}`}
                                    >
                                        <div className="flex items-start gap-4">
                                            <input
                                                type="checkbox"
                                                checked={reminder.completed}
                                                onChange={() => onToggleReminder(reminder.id)}
                                                className="mt-1 h-5 w-5 text-navy rounded focus:ring-navy border-slate-300"
                                            />
                                            <div className="flex-1">
                                                <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-2">
                                                    <div>
                                                        <h3 className={`font-bold text-navy ${
                                                            reminder.completed ? 'line-through' : ''
                                                        }`}>
                                                            {reminder.title}
                                                        </h3>
                                                        {contact ? (
                                                            <p className="text-xs text-slate-500 mt-0.5">
                                                                <i className="fas fa-user mr-1"></i> {contact.name} 
                                                                {firm && <span className="mx-1"></span>}
                                                                {firm && <span>{firm.name}</span>}
                                                            </p>
                                                        ) : firm ? (
                                                            <p className="text-xs text-slate-500 mt-0.5">
                                                                <i className="fas fa-building mr-1"></i> {firm.name} ({firm.office})
                                                            </p>
                                                        ) : null}
                                                        {reminder.type && (
                                                            <p className="text-[10px] uppercase tracking-wider font-bold text-navy mt-1 inline-block bg-slate-100 px-1.5 py-0.5 rounded">
                                                                {reminder.type === 'Assessment' && <i className="fas fa-laptop-code mr-1"></i>}
                                                                {reminder.type === 'Interview' && <i className="fas fa-user-tie mr-1"></i>}
                                                                {reminder.type === 'HireVue' && <i className="fas fa-video mr-1"></i>}
                                                                {reminder.type}
                                                            </p>
                                                        )}
                                                    </div>
                                                    <div className="flex items-center gap-2">
                                                        <span className={`text-[10px] uppercase tracking-wider font-bold px-2 py-1 rounded border ${
                                                            isToday ? 'bg-navy text-white border-navy' :
                                                            isPast ? 'bg-red-50 text-red-700 border-red-200' :
                                                            'bg-slate-50 text-slate-600 border-slate-200'
                                                        }`}>
                                                            {isToday ? 'Today' : (
                                                                !isNaN(new Date(reminder.date).getTime()) 
                                                                    ? new Date(reminder.date).toLocaleDateString() 
                                                                    : 'Invalid Date'
                                                            )}
                                                        </span>
                                                        <button
                                                            onClick={() => onDeleteReminder(reminder.id)}
                                                            className="text-slate-400 hover:text-red-600"
                                                        >
                                                            <i className="fas fa-trash"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                                {reminder.notes && (
                                                    <p className="text-sm text-slate-600 mt-2">{reminder.notes}</p>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    )}
                </div>
            );
        }

        function AnalyticsView({ firms, contacts, interactions, reminders }) {
            const stats = useMemo(() => {
                const applicationsByStatus = firms.reduce((acc, firm) => {
                    acc[firm.status] = (acc[firm.status] || 0) + 1;
                    return acc;
                }, {});

                const contactsByStatus = contacts.reduce((acc, contact) => {
                    acc[contact.status] = (acc[contact.status] || 0) + 1;
                    return acc;
                }, {});

                const today = new Date().toISOString().split('T')[0];
                const upcomingReminders = reminders.filter(r => !r.completed && r.date >= today).length;
                const overdueReminders = reminders.filter(r => !r.completed && r.date < today).length;

                // Top ranked firms
                const rankedFirms = firms.filter(f => f.ranking && f.ranking <= 10).sort((a, b) => a.ranking - b.ranking);

                return {
                    totalFirms: firms.length,
                    totalContacts: contacts.length,
                    totalInteractions: interactions.length,
                    totalReminders: reminders.length,
                    upcomingReminders,
                    overdueReminders,
                    applicationsByStatus,
                    contactsByStatus,
                    rankedFirms
                };
            }, [firms, contacts, interactions, reminders]);

            return (
                <div>
                    <h2 className="text-2xl font-bold text-navy font-serif mb-6">ANALYTICS DASHBOARD</h2>

                    {/* Key Metrics */}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                        <div className="bg-white rounded border border-slate-200 p-6 shadow-sm">
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="text-slate-500 text-xs font-bold uppercase tracking-wider">Target Firms</p>
                                    <p className="text-3xl font-bold text-navy mt-1 font-serif">{stats.totalFirms}</p>
                                </div>
                                <i className="fas fa-building text-3xl text-navy"></i>
                            </div>
                        </div>

                        <div className="bg-white rounded border border-slate-200 p-6 shadow-sm">
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="text-slate-500 text-xs font-bold uppercase tracking-wider">Total Contacts</p>
                                    <p className="text-3xl font-bold text-navy mt-1 font-serif">{stats.totalContacts}</p>
                                </div>
                                <i className="fas fa-users text-3xl text-emerald-600"></i>
                            </div>
                        </div>

                        <div className="bg-white rounded border border-slate-200 p-6 shadow-sm">
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="text-slate-500 text-xs font-bold uppercase tracking-wider">Total Interactions</p>
                                    <p className="text-3xl font-bold text-navy mt-1 font-serif">{stats.totalInteractions}</p>
                                </div>
                                <i className="fas fa-comments text-3xl text-violet-600"></i>
                            </div>
                        </div>

                        <div className="bg-white rounded border border-slate-200 p-6 shadow-sm">
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="text-slate-500 text-xs font-bold uppercase tracking-wider">Upcoming Follow-ups</p>
                                    <p className="text-3xl font-bold text-navy mt-1 font-serif">{stats.upcomingReminders}</p>
                                </div>
                                <i className="fas fa-calendar-check text-3xl text-amber-600"></i>
                            </div>
                        </div>
                    </div>

                    {/* Top Rankings */}
                    {stats.rankedFirms.length > 0 && (
                        <div className="bg-white rounded border border-slate-200 p-6 mb-6 shadow-sm">
                            <h3 className="font-bold text-lg mb-4 font-serif text-navy">YOUR TOP RANKED FIRMS</h3>
                            <div className="space-y-2">
                                {stats.rankedFirms.map(firm => (
                                    <div key={firm.id} className="flex items-center gap-3 p-3 bg-slate-50 rounded border border-slate-200">
                                        <span className="bg-navy text-white font-bold text-xs w-8 h-8 rounded-full flex items-center justify-center border border-navy">
                                            {firm.ranking}
                                        </span>
                                        <div className="flex-1">
                                            <div className="font-bold text-navy">{firm.name}</div>
                                            <div className="text-xs text-slate-500 uppercase tracking-wide">{firm.office}</div>
                                        </div>
                                        <span className={`px-2 py-1 rounded text-[10px] uppercase tracking-wider font-bold border ${
                                            firm.status === 'Accepted' ? 'bg-emerald-50 text-emerald-700 border-emerald-200' :
                                            firm.status === 'Offered' ? 'bg-emerald-50 text-emerald-700 border-emerald-200' :
                                            firm.status === 'Interview Completed' ? 'bg-blue-50 text-blue-700 border-blue-200' :
                                            'bg-slate-50 text-slate-600 border-slate-200'
                                        }`}>
                                            {firm.status}
                                        </span>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* Charts */}
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        {/* Application Status */}
                        <div className="bg-white rounded border border-slate-200 p-6 shadow-sm">
                            <h3 className="font-bold text-lg mb-4 font-serif text-navy">APPLICATION STATUS</h3>
                            {Object.keys(stats.applicationsByStatus).length > 0 ? (
                                <div className="space-y-3">
                                    {Object.entries(stats.applicationsByStatus).map(([status, count]) => (
                                        <div key={status}>
                                            <div className="flex justify-between mb-1">
                                                <span className="text-xs font-bold text-slate-500 uppercase tracking-wide">{status}</span>
                                                <span className="text-xs font-bold text-navy">{count}</span>
                                            </div>
                                            <div className="w-full bg-slate-100 rounded-full h-1.5">
                                                <div
                                                    className={`h-1.5 rounded-full ${
                                                        status === 'Accepted' ? 'bg-emerald-600' :
                                                        status === 'Offered' ? 'bg-emerald-500' :
                                                        status === 'Interview Completed' ? 'bg-blue-600' :
                                                        status === 'Interview Scheduled' ? 'bg-indigo-600' :
                                                        status === 'HireVue/Assessment Completed' ? 'bg-violet-600' :
                                                        status === 'HireVue/Assessment Pending' ? 'bg-amber-500' :
                                                        status === 'Rejected' ? 'bg-red-500' :
                                                        'bg-slate-400'
                                                    }`}
                                                    style={{ width: `${(count / stats.totalFirms) * 100}%` }}
                                                ></div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            ) : (
                                <p className="text-slate-400 text-center py-8 text-sm italic">No application data yet</p>
                            )}
                        </div>

                        {/* Contact Status */}
                        <div className="bg-white rounded border border-slate-200 p-6 shadow-sm">
                            <h3 className="font-bold text-lg mb-4 font-serif text-navy">CONTACT STATUS</h3>
                            {Object.keys(stats.contactsByStatus).length > 0 ? (
                                <div className="space-y-3">
                                    {Object.entries(stats.contactsByStatus).map(([status, count]) => (
                                        <div key={status}>
                                            <div className="flex justify-between mb-1">
                                                <span className="text-xs font-bold text-slate-500 uppercase tracking-wide">{status}</span>
                                                <span className="text-xs font-bold text-navy">{count}</span>
                                            </div>
                                            <div className="w-full bg-slate-100 rounded-full h-1.5">
                                                <div
                                                    className={`h-1.5 rounded-full ${
                                                        status === 'Met' ? 'bg-emerald-600' :
                                                        status === 'Meeting Scheduled' ? 'bg-navy' :
                                                        status === 'Responded' ? 'bg-amber-500' :
                                                        status === 'Reached Out' ? 'bg-violet-600' :
                                                        'bg-slate-400'
                                                    }`}
                                                    style={{ width: `${(count / stats.totalContacts) * 100}%` }}
                                                ></div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            ) : (
                                <p className="text-slate-400 text-center py-8 text-sm italic">No contact data yet</p>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        // Location Picker Component
        function LocationPicker({ value, onChange }) {
            const [country, setCountry] = useState('United States');
            const [city, setCity] = useState('New York');

            useEffect(() => {
                if (value) {
                    // Try to parse existing value
                    const parts = value.split(', ');
                    if (parts.length >= 2) {
                        setCity(parts[0]);
                        // Find country
                        for (const [countryName, cities] of Object.entries(CITIES)) {
                            if (cities.includes(parts[0])) {
                                setCountry(countryName);
                                break;
                            }
                        }
                    }
                }
            }, []);

            useEffect(() => {
                onChange(formatLocation(city, country));
            }, [city, country]);

            return (
                <div className="grid grid-cols-2 gap-3">
                    <div>
                        <label className="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">Country</label>
                        <select
                            value={country}
                            onChange={(e) => {
                                setCountry(e.target.value);
                                setCity(CITIES[e.target.value][0]);
                            }}
                            className="w-full border border-slate-300 rounded px-3 py-2 text-sm focus:ring-navy focus:border-navy"
                        >
                            {Object.keys(CITIES).map(c => (
                                <option key={c} value={c}>{c}</option>
                            ))}
                        </select>
                    </div>
                    <div>
                        <label className="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">City</label>
                        <select
                            value={city}
                            onChange={(e) => setCity(e.target.value)}
                            className="w-full border border-slate-300 rounded px-3 py-2 text-sm focus:ring-navy focus:border-navy"
                        >
                            {CITIES[country].map(c => (
                                <option key={c} value={c}>{c}</option>
                            ))}
                        </select>
                    </div>
                </div>
            );
        }

        // Modals
        function AddFirmModal({ firms, onClose, onAdd }) {
            const [formData, setFormData] = useState({
                name: '',
                division: '',
                office: 'New York, NY, USA',
                ranking: null,
                status: 'Not Applied',
                notes: ''
            });

            // Get existing firms at the selected location
            const firmsAtLocation = firms.filter(f => f.office === formData.office);
            const takenRankings = firmsAtLocation.map(f => f.ranking).filter(Boolean);
            const availableRankings = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10].filter(r => !takenRankings.includes(r));

            const handleSubmit = (e) => {
                e.preventDefault();
                if (formData.name.trim()) {
                    onAdd(formData);
                }
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 overflow-y-auto">
                    <div className="bg-white rounded border border-slate-200 shadow-lg max-w-md w-full p-6 my-8">
                        <h2 className="text-xl font-bold mb-4 font-serif text-navy">ADD NEW FIRM</h2>
                        <form onSubmit={handleSubmit}>
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">
                                        Firm Name *
                                    </label>
                                    <input
                                        type="text"
                                        value={formData.name}
                                        onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                                        className="w-full border border-slate-300 rounded px-3 py-2 focus:ring-navy focus:border-navy"
                                        required
                                    />
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-2">
                                        Office Location *
                                    </label>
                                    <LocationPicker
                                        value={formData.office}
                                        onChange={(location) => setFormData({ ...formData, office: location })}
                                    />
                                    <p className="text-xs text-gray-500 mt-1">Format: {formData.office}</p>
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">
                                        Division
                                    </label>
                                    <input
                                        type="text"
                                        value={formData.division}
                                        onChange={(e) => setFormData({ ...formData, division: e.target.value })}
                                        placeholder="e.g., M&A, ECM, Sales & Trading"
                                        className="w-full border border-slate-300 rounded px-3 py-2 focus:ring-navy focus:border-navy"
                                    />
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">
                                        Ranking for {formData.office}
                                    </label>
                                    <select
                                        value={formData.ranking || ''}
                                        onChange={(e) => setFormData({ ...formData, ranking: e.target.value ? parseInt(e.target.value) : null })}
                                        className="w-full border border-slate-300 rounded px-3 py-2 focus:ring-navy focus:border-navy"
                                    >
                                        <option value="">Unranked</option>
                                        {availableRankings.map(rank => (
                                            <option key={rank} value={rank}>#{rank}</option>
                                        ))}
                                    </select>
                                    {availableRankings.length === 0 && (
                                        <p className="text-xs text-amber-600 mt-1">
                                            All top 10 spots taken for this location
                                        </p>
                                    )}
                                    {takenRankings.length > 0 && (
                                        <p className="text-xs text-gray-500 mt-1">
                                            Taken: {takenRankings.sort((a, b) => a - b).join(', ')}
                                        </p>
                                    )}
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">
                                        Application Status
                                    </label>
                                    <select
                                        value={formData.status}
                                        onChange={(e) => setFormData({ ...formData, status: e.target.value })}
                                        className="w-full border border-slate-300 rounded px-3 py-2 focus:ring-navy focus:border-navy"
                                    >
                                        {APPLICATION_STATUSES.map(status => (
                                            <option key={status} value={status}>{status}</option>
                                        ))}
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">
                                        Notes
                                    </label>
                                    <textarea
                                        value={formData.notes}
                                        onChange={(e) => setFormData({ ...formData, notes: e.target.value })}
                                        className="w-full border border-slate-300 rounded px-3 py-2 focus:ring-navy focus:border-navy"
                                        rows="3"
                                    />
                                </div>
                            </div>
                            <div className="flex gap-3 mt-6">
                                <button
                                    type="button"
                                    onClick={onClose}
                                    className="flex-1 border border-slate-300 rounded px-4 py-2 text-xs font-bold uppercase tracking-wider hover:bg-slate-50"
                                >
                                    Cancel
                                </button>
                                <button
                                    type="submit"
                                    className="flex-1 bg-navy text-white rounded px-4 py-2 text-xs font-bold uppercase tracking-wider hover:bg-navy-light"
                                >
                                    Add Firm
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        function AddContactModal({ firms, contact, onClose, onAdd }) {
            const [formData, setFormData] = useState(contact || {
                name: '',
                firm_id: firms[0]?.id || '',
                title: '',
                email: '',
                phone: '',
                linkedin: '',
                connection_type: '',
                status: 'To Reach Out',
                notes: ''
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                if (formData.name.trim() && formData.firm_id) {
                    onAdd(formData);
                }
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 overflow-y-auto">
                    <div className="bg-white rounded border border-slate-200 shadow-lg max-w-md w-full p-6 my-8">
                        <h2 className="text-xl font-bold mb-4 font-serif text-navy">{contact ? 'EDIT' : 'ADD'} CONTACT</h2>
                        <form onSubmit={handleSubmit}>
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">
                                        Name *
                                    </label>
                                    <input
                                        type="text"
                                        value={formData.name}
                                        onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                                        className="w-full border border-slate-300 rounded px-3 py-2 focus:ring-navy focus:border-navy"
                                        required
                                    />
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">
                                        Firm *
                                    </label>
                                    <select
                                        value={formData.firm_id}
                                        onChange={(e) => setFormData({ ...formData, firm_id: parseInt(e.target.value) })}
                                        className="w-full border border-slate-300 rounded px-3 py-2 focus:ring-navy focus:border-navy"
                                        required
                                    >
                                        {firms.map(firm => (
                                            <option key={firm.id} value={firm.id}>{firm.name} - {firm.office}</option>
                                        ))}
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">
                                        Title
                                    </label>
                                    <input
                                        type="text"
                                        value={formData.title}
                                        onChange={(e) => setFormData({ ...formData, title: e.target.value })}
                                        placeholder="e.g., VP, Analyst, Managing Director"
                                        className="w-full border border-slate-300 rounded px-3 py-2 focus:ring-navy focus:border-navy"
                                    />
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">
                                        Email
                                    </label>
                                    <input
                                        type="email"
                                        value={formData.email}
                                        onChange={(e) => setFormData({ ...formData, email: e.target.value })}
                                        className="w-full border border-slate-300 rounded px-3 py-2 focus:ring-navy focus:border-navy"
                                    />
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">
                                        Phone
                                    </label>
                                    <input
                                        type="tel"
                                        value={formData.phone}
                                        onChange={(e) => setFormData({ ...formData, phone: e.target.value })}
                                        className="w-full border border-slate-300 rounded px-3 py-2 focus:ring-navy focus:border-navy"
                                    />
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">
                                        LinkedIn
                                    </label>
                                    <input
                                        type="url"
                                        value={formData.linkedin}
                                        onChange={(e) => setFormData({ ...formData, linkedin: e.target.value })}
                                        placeholder="https://linkedin.com/in/..."
                                        className="w-full border border-slate-300 rounded px-3 py-2 focus:ring-navy focus:border-navy"
                                    />
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">
                                        Connection Type
                                    </label>
                                    <input
                                        type="text"
                                        value={formData.connection_type}
                                        onChange={(e) => setFormData({ ...formData, connection_type: e.target.value })}
                                        placeholder="e.g., Same school, Same hometown, Alumni network"
                                        className="w-full border border-slate-300 rounded px-3 py-2 focus:ring-navy focus:border-navy"
                                    />
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">
                                        Status
                                    </label>
                                    <select
                                        value={formData.status}
                                        onChange={(e) => setFormData({ ...formData, status: e.target.value })}
                                        className="w-full border border-slate-300 rounded px-3 py-2 focus:ring-navy focus:border-navy"
                                    >
                                        {CONTACT_STATUSES.map(status => (
                                            <option key={status} value={status}>{status}</option>
                                        ))}
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">
                                        Notes
                                    </label>
                                    <textarea
                                        value={formData.notes}
                                        onChange={(e) => setFormData({ ...formData, notes: e.target.value })}
                                        className="w-full border border-slate-300 rounded px-3 py-2 focus:ring-navy focus:border-navy"
                                        rows="3"
                                    />
                                </div>
                            </div>
                            <div className="flex gap-3 mt-6">
                                <button
                                    type="button"
                                    onClick={onClose}
                                    className="flex-1 border border-slate-300 rounded px-4 py-2 text-xs font-bold uppercase tracking-wider hover:bg-slate-50"
                                >
                                    Cancel
                                </button>
                                <button
                                    type="submit"
                                    className="flex-1 bg-navy text-white rounded px-4 py-2 text-xs font-bold uppercase tracking-wider hover:bg-navy-light"
                                >
                                    {contact ? 'Update' : 'Add'} Contact
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        function ContactDetailModal({ contact, firm, interactions, onClose, onAddInteraction, onDeleteInteraction, onAddReminder }) {
            const [showAddInteraction, setShowAddInteraction] = useState(false);
            const [newInteraction, setNewInteraction] = useState({
                type: 'Email Sent',
                date: new Date().toISOString().split('T')[0],
                notes: ''
            });

            const sortedInteractions = [...interactions].sort((a, b) => new Date(b.date) - new Date(a.date));

            const handleAddInteraction = (e) => {
                e.preventDefault();
                onAddInteraction({
                    ...newInteraction,
                    contact_id: contact.id
                });
                setNewInteraction({
                    type: 'Email Sent',
                    date: new Date().toISOString().split('T')[0],
                    notes: ''
                });
                setShowAddInteraction(false);
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 overflow-y-auto">
                    <div className="bg-white rounded border border-slate-200 shadow-lg max-w-3xl w-full p-6 my-8 max-h-[90vh] overflow-y-auto">
                        <div className="flex justify-between items-start mb-4">
                            <div>
                                <h2 className="text-2xl font-bold font-serif text-navy">{contact.name}</h2>
                                <p className="text-gray-600">{contact.title}  {firm?.name} - {firm?.office}</p>
                            </div>
                            <button onClick={onClose} className="text-gray-500 hover:text-gray-700">
                                <i className="fas fa-times text-xl"></i>
                            </button>
                        </div>

                        {/* Contact Info */}
                        <div className="bg-slate-50 rounded border border-slate-200 p-4 mb-6 space-y-2">
                            {contact.email && (
                                <div className="flex items-center text-sm">
                                    <i className="fas fa-envelope w-5 text-gray-500"></i>
                                    <a href={`mailto:${contact.email}`} className="text-blue-600 hover:underline ml-2">
                                        {contact.email}
                                    </a>
                                </div>
                            )}
                            {contact.phone && (
                                <div className="flex items-center text-sm">
                                    <i className="fas fa-phone w-5 text-gray-500"></i>
                                    <a href={`tel:${contact.phone}`} className="text-blue-600 hover:underline ml-2">
                                        {contact.phone}
                                    </a>
                                </div>
                            )}
                            {contact.linkedin && (
                                <div className="flex items-center text-sm">
                                    <i className="fab fa-linkedin w-5 text-gray-500"></i>
                                    <a href={contact.linkedin} target="_blank" rel="noopener noreferrer" className="text-blue-600 hover:underline ml-2">
                                        LinkedIn Profile
                                    </a>
                                </div>
                            )}
                            {contact.connection_type && (
                                <div className="flex items-center text-sm">
                                    <i className="fas fa-link w-5 text-gray-500"></i>
                                    <span className="ml-2 text-gray-700">Connection: {contact.connection_type}</span>
                                </div>
                            )}
                            <div className="flex items-center text-sm">
                                <i className="fas fa-flag w-5 text-gray-500"></i>
                                <span className="ml-2">
                                    <span className={`px-2 py-1 rounded text-[10px] uppercase tracking-wider font-bold border ${
                                        contact.status === 'Met' ? 'bg-emerald-50 text-emerald-700 border-emerald-200' :
                                        contact.status === 'Meeting Scheduled' ? 'bg-navy text-white border-navy' :
                                        contact.status === 'Responded' ? 'bg-amber-50 text-amber-700 border-amber-200' :
                                        contact.status === 'Reached Out' ? 'bg-violet-50 text-violet-700 border-violet-200' :
                                        'bg-slate-50 text-slate-600 border-slate-200'
                                    }`}>
                                        {contact.status}
                                    </span>
                                </span>
                            </div>
                            {contact.notes && (
                                <div className="text-sm pt-2 border-t mt-2">
                                    <p className="text-gray-700">{contact.notes}</p>
                                </div>
                            )}
                        </div>

                        {/* Actions */}
                        <div className="flex gap-3 mb-6">
                            <button
                                onClick={() => setShowAddInteraction(!showAddInteraction)}
                                className="flex-1 bg-navy text-white px-4 py-2 rounded text-xs font-bold uppercase tracking-wider hover:bg-navy-light"
                            >
                                <i className="fas fa-plus mr-2"></i>Log Interaction
                            </button>
                            <button
                                onClick={onAddReminder}
                                className="flex-1 bg-violet-600 text-white px-4 py-2 rounded text-xs font-bold uppercase tracking-wider hover:bg-violet-700"
                            >
                                <i className="fas fa-bell mr-2"></i>Set Reminder
                            </button>
                        </div>

                        {/* Add Interaction Form */}
                        {showAddInteraction && (
                            <div className="bg-slate-50 border border-slate-200 rounded p-4 mb-6">
                                <h3 className="font-bold text-navy mb-3 uppercase text-xs tracking-wide">New Interaction</h3>
                                <form onSubmit={handleAddInteraction} className="space-y-3">
                                    <div className="grid grid-cols-2 gap-3">
                                        <div>
                                            <label className="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">Type</label>
                                            <select
                                                value={newInteraction.type}
                                                onChange={(e) => setNewInteraction({ ...newInteraction, type: e.target.value })}
                                                className="w-full border border-slate-300 rounded px-3 py-2 focus:ring-navy focus:border-navy"
                                            >
                                                {INTERACTION_TYPES.map(type => (
                                                    <option key={type} value={type}>{type}</option>
                                                ))}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">Date</label>
                                            <input
                                                type="date"
                                                value={newInteraction.date}
                                                onChange={(e) => setNewInteraction({ ...newInteraction, date: e.target.value })}
                                                className="w-full border border-slate-300 rounded px-3 py-2 focus:ring-navy focus:border-navy"
                                                required
                                            />
                                        </div>
                                    </div>
                                    <div>
                                        <label className="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">Notes</label>
                                        <textarea
                                            value={newInteraction.notes}
                                            onChange={(e) => setNewInteraction({ ...newInteraction, notes: e.target.value })}
                                            className="w-full border border-slate-300 rounded px-3 py-2 focus:ring-navy focus:border-navy"
                                            rows="2"
                                            placeholder="What did you discuss? Any follow-up needed?"
                                        />
                                    </div>
                                    <div className="flex gap-2">
                                        <button
                                            type="submit"
                                            className="bg-navy text-white px-4 py-2 rounded text-xs font-bold uppercase tracking-wider hover:bg-navy-light"
                                        >
                                            Save Interaction
                                        </button>
                                        <button
                                            type="button"
                                            onClick={() => setShowAddInteraction(false)}
                                            className="border border-slate-300 px-4 py-2 rounded text-xs font-bold uppercase tracking-wider hover:bg-slate-50"
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                </form>
                            </div>
                        )}

                        {/* Interactions Timeline */}
                        <div>
                            <h3 className="font-bold text-lg mb-3 font-serif text-navy">
                                Interaction History ({interactions.length})
                            </h3>
                            {sortedInteractions.length === 0 ? (
                                <p className="text-slate-400 text-center py-8 bg-slate-50 rounded border border-slate-200 text-sm italic">
                                    No interactions logged yet
                                </p>
                            ) : (
                                <div className="space-y-3">
                                    {sortedInteractions.map(interaction => (
                                        <div key={interaction.id} className="border border-slate-200 rounded p-4 hover:bg-slate-50 transition-colors">
                                            <div className="flex justify-between items-start mb-2">
                                                <div>
                                                    <span className="font-bold text-navy">{interaction.type}</span>
                                                    <span className="text-sm text-gray-500 ml-3">
                                                        {!isNaN(new Date(interaction.date).getTime()) 
                                                            ? new Date(interaction.date).toLocaleDateString() 
                                                            : ''}
                                                    </span>
                                                </div>
                                                <button
                                                    onClick={() => onDeleteInteraction(interaction.id)}
                                                    className="text-slate-400 hover:text-red-600 text-sm"
                                                >
                                                    <i className="fas fa-trash"></i>
                                                </button>
                                            </div>
                                            {interaction.notes && (
                                                <p className="text-sm text-gray-600">{interaction.notes}</p>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        function AddReminderModal({ contacts, firms, preselectedContact, onClose, onAdd }) {
            const [formData, setFormData] = useState({
                contact_id: preselectedContact?.id || '',
                firm_id: '',
                title: '',
                type: 'Follow-up',
                date: new Date().toISOString().split('T')[0],
                notes: ''
            });
            
            // If preselectedContact is passed, we are in "Contact Mode" by default.
            // Otherwise, user can choose.
            const [linkType, setLinkType] = useState(preselectedContact ? 'contact' : 'firm');

            const handleSubmit = (e) => {
                e.preventDefault();
                if (formData.title.trim() && (formData.contact_id || formData.firm_id)) {
                    onAdd({
                        ...formData,
                        contact_id: formData.contact_id || null,
                        firm_id: formData.firm_id || null
                    });
                }
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                    <div className="bg-white rounded border border-slate-200 shadow-lg max-w-md w-full p-6">
                        <h2 className="text-xl font-bold mb-4 font-serif text-navy">ADD FOLLOW-UP REMINDER</h2>
                        <form onSubmit={handleSubmit}>
                            <div className="space-y-4">
                                {/* Link Type Selector */}
                                {!preselectedContact && (
                                    <div className="flex bg-slate-100 p-1 rounded border border-slate-200">
                                        <button
                                            type="button"
                                            onClick={() => {
                                                setLinkType('firm');
                                                setFormData({ ...formData, contact_id: '', firm_id: firms[0]?.id || '' });
                                            }}
                                            className={`flex-1 py-1.5 text-xs font-bold uppercase tracking-wider rounded transition-all ${linkType === 'firm' ? 'bg-white shadow-sm text-navy' : 'text-slate-500'}`}
                                        >
                                            Link to Firm
                                        </button>
                                        <button
                                            type="button"
                                            onClick={() => {
                                                setLinkType('contact');
                                                setFormData({ ...formData, firm_id: '', contact_id: contacts[0]?.id || '' });
                                            }}
                                            className={`flex-1 py-1.5 text-xs font-bold uppercase tracking-wider rounded transition-all ${linkType === 'contact' ? 'bg-white shadow-sm text-navy' : 'text-slate-500'}`}
                                        >
                                            Link to Contact
                                        </button>
                                    </div>
                                )}

                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">
                                        {linkType === 'contact' ? 'Contact *' : 'Firm *'}
                                    </label>
                                    {linkType === 'contact' ? (
                                        <select
                                            value={formData.contact_id}
                                            onChange={(e) => setFormData({ ...formData, contact_id: parseInt(e.target.value) })}
                                            className="w-full border border-slate-300 rounded px-3 py-2 focus:ring-navy focus:border-navy"
                                            required
                                            disabled={!!preselectedContact}
                                        >
                                            <option value="">Select a contact...</option>
                                            {contacts.map(contact => {
                                                const firm = firms.find(f => f.id === contact.firm_id);
                                                return (
                                                    <option key={contact.id} value={contact.id}>
                                                        {contact.name} - {firm?.name} ({firm?.office})
                                                    </option>
                                                );
                                            })}
                                        </select>
                                    ) : (
                                        <select
                                            value={formData.firm_id}
                                            onChange={(e) => setFormData({ ...formData, firm_id: parseInt(e.target.value) })}
                                            className="w-full border border-slate-300 rounded px-3 py-2 focus:ring-navy focus:border-navy"
                                            required
                                        >
                                            <option value="">Select a firm...</option>
                                            {firms.map(firm => (
                                                <option key={firm.id} value={firm.id}>
                                                    {firm.name} - {firm.office}
                                                </option>
                                            ))}
                                        </select>
                                    )}
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">Type</label>
                                    <select
                                        value={formData.type}
                                        onChange={(e) => setFormData({ ...formData, type: e.target.value })}
                                        className="w-full border border-slate-300 rounded px-3 py-2 focus:ring-navy focus:border-navy"
                                    >
                                        {REMINDER_TYPES.map(type => (
                                            <option key={type} value={type}>{type}</option>
                                        ))}
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">
                                        Reminder Title *
                                    </label>
                                    <input
                                        type="text"
                                        value={formData.title}
                                        onChange={(e) => setFormData({ ...formData, title: e.target.value })}
                                        placeholder="e.g., Send follow-up email, Schedule coffee chat"
                                        className="w-full border border-slate-300 rounded px-3 py-2 focus:ring-navy focus:border-navy"
                                        required
                                    />
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">
                                        Date *
                                    </label>
                                    <input
                                        type="date"
                                        value={formData.date}
                                        onChange={(e) => setFormData({ ...formData, date: e.target.value })}
                                        className="w-full border border-slate-300 rounded px-3 py-2 focus:ring-navy focus:border-navy"
                                        required
                                    />
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">
                                        Notes
                                    </label>
                                    <textarea
                                        value={formData.notes}
                                        onChange={(e) => setFormData({ ...formData, notes: e.target.value })}
                                        className="w-full border border-slate-300 rounded px-3 py-2 focus:ring-navy focus:border-navy"
                                        rows="3"
                                        placeholder="What do you want to follow up about?"
                                    />
                                </div>
                            </div>
                            <div className="flex gap-3 mt-6">
                                <button
                                    type="button"
                                    onClick={onClose}
                                    className="flex-1 border border-slate-300 rounded px-4 py-2 text-xs font-bold uppercase tracking-wider hover:bg-slate-50"
                                >
                                    Cancel
                                </button>
                                <button
                                    type="submit"
                                    className="flex-1 bg-navy text-white rounded px-4 py-2 text-xs font-bold uppercase tracking-wider hover:bg-navy-light"
                                >
                                    Add Reminder
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        function FirmDetailModal({ firm, contacts, interactions, onClose, onUpdateFirm, onDeleteFirm }) {
            const [isEditing, setIsEditing] = useState(false);
            const [formData, setFormData] = useState(firm);

            const handleSave = () => {
                onUpdateFirm(firm.id, formData);
                setIsEditing(false);
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 overflow-y-auto">
                    <div className="bg-white rounded border border-slate-200 shadow-lg max-w-2xl w-full p-6 my-8">
                        <div className="flex justify-between items-start mb-4">
                            <div>
                                <div className="flex items-center gap-2 mb-1">
                                    {firm.ranking && firm.ranking <= 10 && (
                                        <span className="bg-navy text-white font-bold text-xs w-6 h-6 rounded-full flex items-center justify-center border border-navy">
                                            {firm.ranking}
                                        </span>
                                    )}
                                    <h2 className="text-2xl font-bold font-serif text-navy">{firm.name}</h2>
                                </div>
                                {firm.office && (
                                    <p className="text-slate-500 text-xs uppercase tracking-wide font-medium">
                                        <i className="fas fa-map-marker-alt mr-1"></i>
                                        {firm.office}
                                    </p>
                                )}
                            </div>
                            <button onClick={onClose} className="text-gray-500 hover:text-gray-700">
                                <i className="fas fa-times text-xl"></i>
                            </button>
                        </div>

                        {isEditing ? (
                            <div className="space-y-4 mb-6">
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-2">Office/Location</label>
                                    <LocationPicker
                                        value={formData.office}
                                        onChange={(location) => setFormData({ ...formData, office: location })}
                                    />
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">Division</label>
                                    <input
                                        type="text"
                                        value={formData.division}
                                        onChange={(e) => setFormData({ ...formData, division: e.target.value })}
                                        className="w-full border border-slate-300 rounded px-3 py-2 focus:ring-navy focus:border-navy"
                                    />
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">Ranking</label>
                                    <select
                                        value={formData.ranking || ''}
                                        onChange={(e) => setFormData({ ...formData, ranking: e.target.value ? parseInt(e.target.value) : null })}
                                        className="w-full border border-slate-300 rounded px-3 py-2 focus:ring-navy focus:border-navy"
                                    >
                                        <option value="">Unranked</option>
                                        {[1, 2, 3, 4, 5, 6, 7, 8, 9, 10].map(rank => (
                                            <option key={rank} value={rank}>#{rank}</option>
                                        ))}
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">Status</label>
                                    <select
                                        value={formData.status}
                                        onChange={(e) => setFormData({ ...formData, status: e.target.value })}
                                        className="w-full border border-slate-300 rounded px-3 py-2 focus:ring-navy focus:border-navy"
                                    >
                                        {APPLICATION_STATUSES.map(status => (
                                            <option key={status} value={status}>{status}</option>
                                        ))}
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">Notes</label>
                                    <textarea
                                        value={formData.notes}
                                        onChange={(e) => setFormData({ ...formData, notes: e.target.value })}
                                        className="w-full border border-slate-300 rounded px-3 py-2 focus:ring-navy focus:border-navy"
                                        rows="4"
                                    />
                                </div>
                                <div className="flex gap-3">
                                    <button
                                        onClick={() => setIsEditing(false)}
                                        className="flex-1 border border-slate-300 rounded px-4 py-2 text-xs font-bold uppercase tracking-wider hover:bg-slate-50"
                                    >
                                        Cancel
                                    </button>
                                    <button
                                        onClick={handleSave}
                                        className="flex-1 bg-navy text-white rounded px-4 py-2 text-xs font-bold uppercase tracking-wider hover:bg-navy-light"
                                    >
                                        Save Changes
                                    </button>
                                </div>
                            </div>
                        ) : (
                            <div className="space-y-4 mb-6">
                                <div>
                                    <span className="text-xs font-bold text-slate-500 uppercase tracking-wide">Division:</span>
                                    <p className="text-gray-900">{firm.division || 'Not specified'}</p>
                                </div>
                                <div>
                                    <span className="text-xs font-bold text-slate-500 uppercase tracking-wide">Ranking:</span>
                                    <p className="text-gray-900">
                                        {firm.ranking && firm.ranking <= 10 ? `#${firm.ranking} for ${firm.office}` : 'Unranked'}
                                    </p>
                                </div>
                                <div>
                                    <span className="text-xs font-bold text-slate-500 uppercase tracking-wide">Status:</span>
                                    <p>
                                        <span className={`inline-block px-3 py-1 rounded text-[10px] uppercase tracking-wider font-bold border ${
                                            firm.status === 'Accepted' ? 'bg-emerald-50 text-emerald-700 border-emerald-200' :
                                            firm.status === 'Offered' ? 'bg-emerald-50 text-emerald-700 border-emerald-200' :
                                            firm.status === 'Interview Completed' ? 'bg-blue-50 text-blue-700 border-blue-200' :
                                            firm.status === 'Interview Scheduled' ? 'bg-indigo-50 text-indigo-700 border-indigo-200' :
                                            firm.status === 'HireVue/Assessment Completed' ? 'bg-violet-50 text-violet-700 border-violet-200' :
                                            firm.status === 'HireVue/Assessment Pending' ? 'bg-amber-50 text-amber-700 border-amber-200' :
                                            firm.status === 'Rejected' ? 'bg-red-50 text-red-700 border-red-200' :
                                            'bg-slate-50 text-slate-600 border-slate-200'
                                        }`}>
                                            {firm.status}
                                        </span>
                                    </p>
                                </div>
                                {firm.notes && (
                                    <div>
                                        <span className="text-xs font-bold text-slate-500 uppercase tracking-wide">Notes:</span>
                                        <p className="text-gray-900 whitespace-pre-wrap">{firm.notes}</p>
                                    </div>
                                )}
                                <div className="flex gap-3">
                                    <button
                                        onClick={() => setIsEditing(true)}
                                        className="flex-1 bg-slate-100 text-slate-700 px-4 py-2 rounded text-xs font-bold uppercase tracking-wider hover:bg-slate-200"
                                    >
                                        <i className="fas fa-edit mr-2"></i>Edit Firm Details
                                    </button>
                                    <button
                                        onClick={() => onDeleteFirm(firm.id)}
                                        className="bg-red-50 text-red-700 px-4 py-2 rounded text-xs font-bold uppercase tracking-wider hover:bg-red-100 border border-red-200"
                                        title="Delete Firm"
                                    >
                                        <i className="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        )}

                        <div className="border-t pt-4">
                            <h3 className="font-bold text-lg mb-3 font-serif text-navy">Contacts ({contacts.length})</h3>
                            {contacts.length === 0 ? (
                                <p className="text-slate-400 text-center py-4 text-sm italic">No contacts at this firm yet</p>
                            ) : (
                                <div className="space-y-3">
                                    {contacts.map(contact => {
                                        const contactInteractions = interactions.filter(i => i.contact_id === contact.id);
                                        return (
                                            <div key={contact.id} className="border border-slate-200 rounded p-4">
                                                <div className="flex justify-between items-start">
                                                    <div>
                                                        <h4 className="font-bold text-navy">{contact.name}</h4>
                                                        {contact.title && (
                                                            <p className="text-xs text-slate-500 uppercase tracking-wide">{contact.title}</p>
                                                        )}
                                                        {contact.email && (
                                                            <p className="text-sm text-gray-500">{contact.email}</p>
                                                        )}
                                                        {contact.connection_type && (
                                                            <p className="text-sm text-blue-600 mt-1">
                                                                <i className="fas fa-link mr-1"></i>
                                                                {contact.connection_type}
                                                            </p>
                                                        )}
                                                        <p className="text-xs text-gray-500 mt-1">
                                                            {contactInteractions.length} interaction{contactInteractions.length !== 1 ? 's' : ''}
                                                        </p>
                                                    </div>
                                                    <span className={`px-2 py-1 rounded text-[10px] uppercase tracking-wider font-bold border ${
                                                        contact.status === 'Met' ? 'bg-emerald-50 text-emerald-700 border-emerald-200' :
                                                        contact.status === 'Meeting Scheduled' ? 'bg-navy text-white border-navy' :
                                                        contact.status === 'Responded' ? 'bg-amber-50 text-amber-700 border-amber-200' :
                                                        contact.status === 'Reached Out' ? 'bg-violet-50 text-violet-700 border-violet-200' :
                                                        'bg-slate-50 text-slate-600 border-slate-200'
                                                    }`}>
                                                        {contact.status}
                                                    </span>
                                                </div>
                                                {contact.notes && (
                                                    <p className="text-sm text-gray-600 mt-2">{contact.notes}</p>
                                                )}
                                            </div>
                                        );
                                    })}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>